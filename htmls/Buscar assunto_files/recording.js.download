document.addEventListener("DOMContentLoaded", function() {

    console.log("A pÃ¡gina foi carregada!");

    var recognizer;

    function startRecording() {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function(stream) {
                recognizer = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognizer.lang = 'pt-BR';

                recognizer.onresult = function(event) {
                    if (event.results.length > 0) {
                        document.getElementById('input-busca').value = event.results[0][0].transcript;
                    }
                }

                recognizer.onend = function() {
                    // document.getElementById('recordButton').innerText = 'Pressione e Segure para Gravar';
                    document.getElementById('loading-voice-record').style.display = 'block';
                }

                recognizer.start();
                document.getElementById('input-busca').placeholder = 'Gravando... (Solte para Parar)';
            })
            .catch(function(err) {
                console.error('Erro ao acessar o microfone: ' + err);
            });
    }

    function stopRecording() {
        if (recognizer) {
            document.getElementById('loading-voice-record').style.display = 'none';
            recognizer.stop();
        }
    }

    var recordButton = document.getElementById('recordButton');
    recordButton.addEventListener('mousedown', startRecording);
    recordButton.addEventListener('mouseup', stopRecording);
    recordButton.addEventListener('touchstart', startRecording);
    recordButton.addEventListener('touchend', stopRecording);
});