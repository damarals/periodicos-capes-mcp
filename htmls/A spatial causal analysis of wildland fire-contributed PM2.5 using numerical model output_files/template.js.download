jQuery(document).ready(function(){

  function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  function setCookie(name, value, days) {
    let expires = "";
    if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
  }

  function brCookieOutput(jsonSaida) {
    setCookie(".periodicos.", jsonSaida, 7);
    setCookie('cookieConsent', 'true', 7);
  }

  function initializeCookieBar() {
    if (!getCookie('cookieConsent')) {
        window.BRCookiebar.createCookiebar(window.jsonData, brCookieOutput);
    }
  }

  initializeCookieBar();

    //Configuracao do datepicker
    //Documentacao (https://github.com/uxsolutions/bootstrap-datepicker
    // jQuery('.filtros-gerais .input-daterange').datepicker({
    //     todayBtn: "linked",
    //     language: "pt-BR",
    //     orientation: "bottom left",
    //     keepEmptyValues: true
    // });

    // jQuery("#input-start").attr("autocomplete", "off");
    // jQuery("#input-end").attr("autocomplete", "off");

    // //Abrir Calendário com click no icone do calendario
    // jQuery('#datepicker > div:nth-child(1) > i').click(function() {
    //     jQuery("#input-start").datepicker("show");
    // });
    // jQuery('#datepicker > div:nth-child(2) > i').click(function() {
    //     jQuery("#input-end").datepicker("show");
    // });

    //Configuraçao de autocomplete
    //Documentação: https://select2.org/
    // jQuery('.autocomplete').select2({language: "pt-BR"});

    //Configuracao da pesquisa no filtro
    jQuery('#icon-search').click(function() {
        jQuery('input[name="limitstart"]').val(0);
        jQuery("form[id='form-padrao-filtro']").submit();
    });

    //Configuracao da limpeza da caixa de filtros
    //FIXME: tem coisas que podem nao funcionar. O ideal era dar um reset no formulario
    jQuery('#icon-clean').click(function(e) {
        let $form = jQuery('#form-padrao-filtro');
        $form.find('input:text, input:password, input:file, textarea').val('');
        $form.find('input[type="text"], input[type="password"], input[type="file"], input[type="search"], textarea').val('');
        $form.find('.br-item').removeClass('selected')
        $form.find('select').removeAttr('selected').val(0);
        $form.find('input:radio').removeAttr('checked').first().prop('checked', true)
        $form.find('input:checkbox').removeAttr('checked').first().prop('checked', true);
        jQuery('input[name="limitstart"]').val(0);
        e.preventDefault();
        jQuery("form[id='form-padrao-filtro']").submit();
    });

    //Configuracao dos filtros para atualizar o resultado apos mudarem
    jQuery(".filtro-formulario").change(function () {
        jQuery("form[id='form-padrao-filtro']").submit();
    });

    jQuery(".back-top").hide();

    jQuery(function () {
        jQuery(window).scroll(function () {
            if (jQuery(this).scrollTop() > 200) {
                jQuery('.back-top').fadeIn();
            } else {
                jQuery('.back-top').fadeOut();
            }
        });        
    });        
});

var easing, e, pos;

jQuery(function(){
  jQuery(".back-top").on("click", function(){
    pos= jQuery(window).scrollTop();
    jQuery("body").css({
      "margin-top": -pos+"px",
      "overflow-y": "scroll", 
    });
    jQuery(window).scrollTop(0);
    jQuery("body").css("transition", "all 1s ease");
    jQuery("body").css("margin-top", "0");
    jQuery("body").on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd", function(){
      jQuery("body").css("transition", "none");
    });
  });


  $.fn.solicitarLogin = function () {
      jQuery(".back-top").click();
      jQuery( "#card-login" ).addClass( "br-sign-in-show" );
      jQuery( "#card-login" ).addClass( "show" );
      jQuery( "#usuario" ).focus();
      pos= jQuery(window).scrollTop();
      jQuery("body").css({
        "margin-top": -pos+"px",
        "overflow-y": "scroll",
      });
      jQuery(window).scrollTop(0);
      jQuery("body").css("transition", "all 1s ease");
      jQuery("body").css("margin-top", "0");
      jQuery("body").on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd", function(){
        jQuery("body").css("transition", "none");
      });
  };
});
